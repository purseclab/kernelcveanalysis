import cpp
import kernel_utils

//from KmallocCache c
//select c.getName(), c.getSizeArg()

// from KmallocCallWithCache c
// select c, c.getCacheNameArg()

from KmallocCall kmalloc_call, Struct s
where
  s = kmalloc_call.getStruct()
  // TODO: find out why this is included
  and not kmalloc_call.getSizeArg().isAffectedByMacro()
  and kmalloc_call.getCacheName() != "default"
select kmalloc_call.getLocation(), kmalloc_call, s, s.getLocation(), s.getSize(), kmalloc_call.getFlag(), kmalloc_call.getSize(), kmalloc_call.isFlexible(), kmalloc_call.getCacheName()

// from FunctionCall c
// where isKmemCacheAllocCall(c)
// select c