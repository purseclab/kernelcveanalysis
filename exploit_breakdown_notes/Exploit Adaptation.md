# What Needs to be Adapted

## Offsets In Binary

## Offsets in Struct

## Characteristics of Kernel Linear Mapping
For example physical load address randomization, if you have pipe buffer arb physical read write (ie. in badspin)
TODO: determine what can change

## Kmalloc Cache Object is From
Some objects may have their size changed, and move to different cache

More commonly, object is moved to a different cache of the same size, either specifically for that object, or from kmallocN to kmallocN-cg
This affects if cross cache attack is needed or not

## Kernel Architecture

## Accessible APIs

# Kexploit Tests
- Badnode
	- Auto annotate: ✅
	- Adapt:
		- reference kernel -> ingots 5.10.101: ✅
- CVE-2023-4244-lts
	- Auto annotate: ⚠️
		- Several offsets are written as sum of random numbers which tool cannot handle
	- Adapt:
		- kernelctf_6.1.36_lts -> kernelctf_6.1.52_lts: ✅
			- Although it fails to adapt one offset, the exploit still works (offset seems to just be pointing to unused writable memory for ROP chain to write stuff to)
- CVE-2024-53141-lts
	- Auto annotate: ✅
		- An extra field called START_ROP which is not supposed to be adapted is sometimes marked as a rop gadget
		- However this does not impact functionality, as adapt will fail to translate and keep original value
	- Adapt:
		- kernelctf_6.6.62_lts -> kernelctf_6.1.52_lts: ✅
		- kernelctf_6.6.62_lts -> kernelctf_6.1.31_lts: ⚠️
			- there are to pop rsi gadgets, one is not used, the other has random instructions in the middle which cause translation failure on this kernel. Switching code to use other gadget fixes problem
- CVE-2023-3777
	- Auto annotate: ⚠️
		- Exploit code has offsets for different kernel, correct ones are commented out
		- Auto annotate works on correct offsets
	- Adapt:
		- kernelctf_6.1.36_lts -> kernelctf_6.1.52_lts: ❌
			- Kernel seems to no longer be vulnerable? (but offsets are correct)
			- Makes sense as release date is after supposed last vulnerable version date
		- kernelctf_6.1.36_lts -> kernelctf_6.1.31_lts: ❌
			- Vulnerability doesn't seem to trigger?
			- This version should be vulnerable, perhaps larger structural changes are needed
			- There is a warning that occurs, chain->use > 0
		- kernelctf_6.1.36_lts -> build_6.1.35_lts: ❌
			- Fails to find some rop gadgets
- CVE-2024-39503
	- Slightly unreliable (repo says 70%, I observed 2/4)
	- Auto annotate: ✅
	- Adapt:
		- kernelctf_6.6.30_lts -> kernelctf_6.6.32_lts ✅

## Other Higher Reliability Exploits to look into
- [CVE-2024-41010](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2024-41010_lts)
- [CVE-2023-3390](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2023-3390_lts_cos_mitigation): build error
- [CVE-2023-3776](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2023-3776_lts): some constants are in a python script
- [CVE-2024-36972](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2024-36972_lts_cos): some constants are in a python script
- [CVE-2023-4004](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2023-4004_lts_cos_mitigation): constants are inline, good for testing

- [CVE-2024-41009](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2024-41009_lts_cos): uses entrybleed, which doesn't work very well