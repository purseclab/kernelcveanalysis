# What Needs to be Adapted

## Offsets In Binary

## Offsets in Struct

## Characteristics of Kernel Linear Mapping
For example physical load address randomization, if you have pipe buffer arb physical read write (ie. in badspin)
TODO: determine what can change

## Kmalloc Cache Object is From
Some objects may have their size changed, and move to different cache

More commonly, object is moved to a different cache of the same size, either specifically for that object, or from kmallocN to kmallocN-cg
This affects if cross cache attack is needed or not

## Kernel Architecture

## Accessible APIs

# Kexploit Tests
- Badnode
	- Auto annotate: ✅
	- Adapt:
		- reference kernel -> ingots 5.10.101: ✅
- CVE-2023-4244-lts
	- Auto annotate: ⚠️
		- Several offsets are written as sum of random numbers which tool cannot handle
	- Adapt:
		- kernelctf_6.1.36_lts -> kernelctf_6.1.52_lts: ✅
			- Although it fails to adapt one offset, the exploit still works (offset seems to just be pointing to unused writable memory for ROP chain to write stuff to)
- CVE-2024-53141-lts
	- Auto annotate: ✅
		- An extra field called START_ROP which is not supposed to be adapted is sometimes marked as a rop gadget
		- However this does not impact functionality, as adapt will fail to translate and keep original value
	- Adapt:
		- kernelctf_6.6.62_lts -> kernelctf_6.1.52_lts: ✅
		- kernelctf_6.6.62_lts -> kernelctf_6.1.31_lts: ⚠️
			- there are to pop rsi gadgets, one is not used, the other has random instructions in the middle which cause translation failure on this kernel. Switching code to use other gadget fixes problem
- CVE-2023-3777
	- Auto annotate: ⚠️
		- Exploit code has offsets for different kernel, correct ones are commented out
		- Auto annotate works on correct offsets
	- Adapt:
		- kernelctf_6.1.36_lts -> kernelctf_6.1.52_lts: ❌
			- Kernel seems to no longer be vulnerable? (but offsets are correct)
			- Makes sense as release date is after supposed last vulnerable version date
		- kernelctf_6.1.36_lts -> kernelctf_6.1.31_lts: ❌
			- Vulnerability doesn't seem to trigger?
			- This version should be vulnerable, perhaps larger structural changes are needed
			- There is a warning that occurs, chain->use > 0
		- kernelctf_6.1.36_lts -> build_6.1.35_lts: ❌
			- Fails to find some rop gadgets
- CVE-2024-39503
	- Slightly unreliable (repo says 70%, I observed 2/4)
	- Auto annotate: ✅
	- Adapt:
		- kernelctf_6.6.30_lts -> kernelctf_6.6.32_lts ✅
- CVE-2023-3611
	- Auto annotate:
		- no-llm: ⚠️
			- Some struct offsets are annotated
	- Adapt:
		- kernelctf_6.1.35_lts -> kernelctf_6.1.31_lts: ❌
			- Issue with rop gadgets
- CVE-2023-4015
	- Fixing build errors:
		- Note for building: build netlink library without glibc.static in nix-shell
		- Modify open O_CREAT to use mode 0644
	- Auto annotate:
		- no-llm: ⚠️
			- One offset is missed
		- llm: test when chatgpt api is back up
	- Adapt:
		- kernelctf_6.1.36 -> kernelctf_6.1.31_lts: ❌
			- Adaptation works to adapt offsets
			- Invalid data is leaked for kernel pointer
			- General protection fault occurs
- CVE-2024-26925
	- Auto annotate:
		- no-llm:✅
	- Adapt:
		- kernelctf_6.1.81_lts -> kernelctf_6.1.70_lts: ✅
- CVE-2023-5345
	- Auto annotate:
		- no-llm: ❌
			- One offset is written as a constant, which is the result bitwise and of another address and mask, to get lowest 20 bits
			- Tool cannot correctly identify that, so have to rewrite it as actuall offset, and mask
	- Adapt:
		- kernelctf_6.1.52_lts -> kernelctf_6.1.36_lts: ✅
- 

## Other Higher Reliability Exploits to look into
- CVE-2023-3390: uses first kernelctf kernel, need to compile kernel to before then which is vulnerable
- [CVE-2024-41010](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2024-41010_lts): exploit doesn't work on original kernel
- [CVE-2023-3776](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2023-3776_lts): some constants are in a python script
- [CVE-2024-36972](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2024-36972_lts_cos): some constants are in a python script
- [CVE-2023-4004](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2023-4004_lts_cos_mitigation): constants are inline, good for testing, but build error
- CVE-2023-4569: build error

- [CVE-2024-41009](https://github.com/google/security-research/tree/master/pocs/linux/kernelctf/CVE-2024-41009_lts_cos): uses entrybleed, which doesn't work very well

## Non Tested Exploits Which Should not Have Any Issues to Test
Basically lts exploits which don't use entrybleed or require seperate kaslr leak and that don't use that netlink libarary that can't be built

- CVE-2023-3390 (uses old kernel, so need to build older one still with vuln to test exploit)
- CVE-2023-3776 (python script): ✅
- CVE-2023-3777 (already manual tested, trigger issue)
- CVE-2023-4207 (low reliability, python script)
- CVE-2023-4208 (python script): ✅
- CVE-2023-5197 (similar to trigger issue exploits): ✅
- CVE-2023-52620: ✅
- CVE-2023-6931: ✅
- CVE-2024-0193 (similar to trigger issue exploits): ✅
- CVE-2024-36972 (python script): ✅

Entrybleed exploits (don't work reliably unless on specific cpu):
- CVE-2024-41009
- and others (~3 total?)

CVE-2024-1086 does not have same netlink libary issue, has some symlinks in build script which would have issues compiling on nixos
These other explits have compile issues due to netlink libary:
- CVE-2023-4004
- CVE-2023-4569
- CVE-2023-6111
- CVE-2023-6187
- CVE-2024-1085
- CVE-2024-26581
- CVE-2024-26642
- CVE-2024-26809